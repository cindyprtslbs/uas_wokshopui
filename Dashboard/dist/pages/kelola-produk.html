<!DOCTYPE html>
<html lang="en">
<head>
    <title>MiniMarket - Kelola Produk</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="MiniMarket Admin Dashboard">
    <meta name="keywords" content="admin, dashboard, minimarket, inventory, sales">
    <meta name="author" content="CodedThemes">

    <link rel="icon" href="../assets/images/favicon.svg" type="image/x-icon">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Public+Sans:wght@300;400;500;600;700&display=swap" id="main-font-link">
    <link rel="stylesheet" href="../assets/fonts/tabler-icons.min.css">
    <link rel="stylesheet" href="../assets/fonts/feather.css">
    <link rel="stylesheet" href="../assets/fonts/fontawesome.css">
    <link rel="stylesheet" href="../assets/fonts/material.css">
    <link rel="stylesheet" href="../assets/css/style.css" id="main-style-link">
    <link rel="stylesheet" href="../assets/css/style-preset.css">

</head>
<body data-pc-preset="preset-1" data-pc-direction="ltr" data-pc-theme="light">
    <div class="loader-bg">
        <div class="loader-track">
            <div class="loader-fill"></div>
        </div>
    </div>
    <nav class="pc-sidebar">
        <div class="navbar-wrapper">
            <div class="m-header">
                <a href="dashboard.html" class="b-brand text-primary">
                    <img src="../assets/images/logo-dark.svg" class="img-fluid logo-lg" alt="logo">
                </a>
            </div>
            <div class="navbar-content">
                <ul class="pc-navbar">
                    <li class="pc-item pc-caption">
                        <label>Navigation</label>
                        <i class="ti ti-dashboard"></i>
                    </li>
                    <li class="pc-item">
                        <a href="dashboard.html" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-dashboard"></i></span>
                            <span class="pc-mtext">Dashboard</span>
                        </a>
                    </li>
                    <li class="pc-item active">
                        <a href="kelola-produk.html" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-box"></i></span>
                            <span class="pc-mtext">Kelola Produk</span>
                        </a>
                    </li>
                    <li class="pc-item">
                        <a href="kelola-transaksi.html" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-receipt"></i></span>
                            <span class="pc-mtext">Kelola Transaksi</span>
                        </a>
                    </li>
                    <li class="pc-item">
                        <a href="history-transaksi.html" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-history"></i></span>
                            <span class="pc-mtext">History Transaksi</span>
                        </a>
                    </li>
                    <li class="pc-item">
                        <a href="kelola-pengguna.html" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-users"></i></span>
                            <span class="pc-mtext">Kelola Pengguna</span>
                        </a>
                    </li>
                    <li class="pc-item">
                        <a href="kelola-artikel.html" class="pc-link">
                            <span class="pc-micon"><i class="ti ti-file-text"></i></span>
                            <span class="pc-mtext">Kelola Artikel</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <header class="pc-header">
        <div class="header-wrapper">
            <div class="me-auto pc-mob-drp">
                <ul class="list-unstyled">
                    <li class="pc-h-item pc-sidebar-collapse">
                        <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
                            <i class="ti ti-menu-2"></i>
                        </a>
                    </li>
                    <li class="pc-h-item pc-sidebar-popup">
                        <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
                            <i class="ti ti-menu-2"></i>
                        </a>
                    </li>
                    <li class="dropdown pc-h-item d-inline-flex d-md-none">
                        <a class="pc-head-link dropdown-toggle arrow-none m-0" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" aria-expanded="false">
                            <i class="ti ti-search"></i>
                        </a>
                        <div class="dropdown-menu pc-h-dropdown drp-search">
                            <form class="px-3">
                                <div class="form-group mb-0 d-flex align-items-center">
                                    <i data-feather="search"></i>
                                    <input type="search" class="form-control border-0 shadow-none" placeholder="Search here. . .">
                                </div>
                            </form>
                        </div>
                    </li>
                </ul>
            </div>
            <div class="ms-auto">
                <ul class="list-unstyled">
                    <li class="dropdown pc-h-item header-user-profile">
                        <a class="pc-head-link dropdown-toggle arrow-none me-0" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="false" data-bs-auto-close="outside" aria-expanded="false">
                            <img src="../assets/images/user/avatar-2.jpg" alt="user-image" class="user-avtar">
                            <span>Admin</span>
                        </a>
                        <div class="dropdown-menu dropdown-user-profile dropdown-menu-end pc-h-dropdown">
                            <div class="dropdown-header">
                                <div class="d-flex mb-1">
                                    <div class="flex-shrink-0">
                                        <img src="../assets/images/user/avatar-2.jpg" alt="user-image" class="user-avtar wid-35">
                                    </div>
                                    <div class="flex-grow-1 ms-3">
                                        <h6 class="mb-1">Admin</h6>
                                        <span>Administrator</span>
                                    </div>
                                    <a href="#!" class="pc-head-link bg-transparent" id="logout-icon">
                                        <i class="ti ti-power text-danger"></i>
                                    </a>
                                </div>
                            </div>
                            <div class="dropdown-divider"></div>
                            <a href="#!" class="dropdown-item" id="logout-option">
                                <i class="ti ti-power"></i>
                                <span>Logout</span>
                            </a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    <div class="pc-container">
        <div class="pc-content">
            <div class="page-header">
                <div class="page-block">
                    <div class="row align-items-center">
                        <div class="col-md-12">
                            <div class="page-header-title">
                                <h5 class="m-b-10">Kelola Produk</h5>
                            </div>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="dashboard.html">Home</a></li>
                                <li class="breadcrumb-item" aria-current="page">Kelola Produk</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-sm-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Daftar Produk</h5>
                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#productModal" id="add-product-btn">
                                <i class="ti ti-plus"></i> Tambah Produk
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <div class="input-group">
                                        <input type="text" class="form-control" placeholder="Cari produk..." id="searchProduct">
                                        <button class="btn btn-outline-secondary" type="button" id="searchButton">
                                            <i class="ti ti-search"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="filterCategory">
                                        <option value="Semua Kategori" selected>Semua Kategori</option>
                                        <option value="Sayuran">Sayuran</option>
                                        <option value="Buahan">Buahan</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <select class="form-select" id="sortProducts">
                                        <option value="Urutkan" selected>Urutkan</option>
                                        <option value="Nama (A-Z)">Nama (A-Z)</option>
                                        <option value="Nama (Z-A)">Nama (Z-A)</option>
                                        <option value="Harga (Rendah-Tinggi)">Harga (Rendah-Tinggi)</option>
                                        <option value="Harga (Tinggi-Rendah)">Harga (Tinggi-Rendah)</option>
                                        <option value="Stok (Rendah-Tinggi)">Stok (Rendah-Tinggi)</option>
                                        <option value="Stok (Tinggi-Rendah)">Stok (Tinggi-Rendah)</option>
                                    </select>
                                </div>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Gambar</th>
                                            <th>Nama Produk</th>
                                            <th>Kategori</th>
                                            <th>Harga</th>
                                            <th>Stok</th>
                                            <th>Status</th>
                                            <th>Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="productTableBody">
                                        </tbody>
                                </table>
                            </div>
                            <div class="row mt-3">
                                <div class="col-sm-12 col-md-5">
                                    <div class="dataTables_info" id="paginationInfo">Menampilkan 0 sampai 0 dari 0 data</div>
                                </div>
                                <div class="col-sm-12 col-md-7">
                                    <div class="dataTables_paginate">
                                        <ul class="pagination justify-content-end" id="paginationControls">
                                            </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="productModalLabel">Tambah Produk</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="productForm">
                        <input type="hidden" id="editProductId">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="productId" class="form-label">ID Produk</label>
                                <input type="text" class="form-control" id="productId" placeholder="Otomatis" disabled>
                            </div>
                            <div class="col-md-6">
                                <label for="productName" class="form-label">Nama Produk</label>
                                <input type="text" class="form-control" id="productName" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="productCategory" class="form-label">Kategori</label>
                                <select class="form-select" id="productCategory" required>
                                    <option value="">Pilih Kategori</option>
                                    <option>Makanan</option>
                                    <option>Minuman</option>
                                    <option>Kebutuhan Pokok</option>
                                    <option>Peralatan Rumah Tangga</option>
                                    <option>Sayuran</option>
                                    <option>Buahan</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="productPrice" class="form-label">Harga (Rp)</label>
                                <input type="number" class="form-control" id="productPrice" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="productStock" class="form-label">Stok</label>
                                <input type="number" class="form-control" id="productStock" required>
                            </div>
                            <div class="col-md-6">
                                <label for="productStatus" class="form-label">Status</label>
                                <select class="form-select" id="productStatus" required>
                                    <option value="Tersedia">Tersedia</option>
                                    <option value="Stok Menipis">Stok Menipis</option>
                                    <option value="Habis">Habis</option>
                                </select>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="productDescription" class="form-label">Deskripsi</label>
                            <textarea class="form-control" id="productDescription" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="productImage" class="form-label">Gambar Produk</label>
                            <input class="form-control" type="file" id="productImage">
                            <div class="form-text">Format: JPG, PNG. Maks: 2MB</div>
                            <img id="productImagePreview" src="" alt="Image Preview" class="img-fluid mt-2" style="max-width: 100px; display: none;">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" class="btn btn-primary" id="saveProductBtn" form="productForm">Simpan</button>
                </div>
            </div>
        </div>
    </div>

    <footer class="pc-footer">
        <div class="footer-wrapper container-fluid">
            <div class="row">
                <div class="col-sm my-1">
                    <p class="m-0">MiniMarket Admin Dashboard &copy; 2025</p>
                </div>
            </div>
        </div>
    </footer>

    <script src="../assets/js/plugins/popper.min.js"></script>
    <script src="../assets/js/plugins/simplebar.min.js"></script>
    <script src="../assets/js/plugins/bootstrap.min.js"></script>
    <script src="../assets/js/fonts/custom-font.js"></script>
    <script src="../assets/js/pcoded.js"></script>
    <script src="../assets/js/plugins/feather.min.js"></script>

    <script>
        layout_change('light');
    </script>
    <script>
        change_box_container('false');
    </script>
    <script>
        layout_rtl_change('false');
    </script>
    <script>
        preset_change("preset-1");
    </script>
    <script>
        font_change("Public-Sans");
    </script>

    <script>
        // Initial product data (you would typically fetch this from a backend)
        let products = [{
            id: 'PRD001',
            image: '../../../uas_workshopui/img/featured/parkcoy.png',
            name: 'Sayur Pakcoy Segar',
            category: 'Sayuran',
            price: 20000,
            stock: 120,
            status: 'Tersedia',
            description: 'Sayur pakcoy segar dari petani lokal.'
        }, {
            id: 'PRD002',
            image: '../../../uas_workshopui/img/featured/bayam.png',
            name: 'Bayam Segar',
            category: 'Sayuran',
            price: 12000,
            stock: 85,
            status: 'Tersedia',
            description: 'Bayam segar kaya akan zat besi.'
        }, {
            id: 'PRD003',
            image: '../../../uas_workshopui/img/featured/wortel.png',
            name: 'Wortel Segar',
            category: 'Sayuran',
            price: 18000,
            stock: 150,
            status: 'Tersedia',
            description: 'Wortel segar pilihan untuk kesehatan mata.'
        }, {
            id: 'PRD004',
            image: '../../../uas_workshopui/img/featured/sawi.png',
            name: 'Sawi Putih Segar',
            category: 'Sayuran',
            price: 17500,
            stock: 100,
            status: 'Tersedia',
            description: 'Sawi putih segar, cocok untuk berbagai masakan.'
        }, {
            id: 'PRD005',
            image: '../../../uas_workshopui/img/featured/buncis.png',
            name: 'Buncis Segar',
            category: 'Sayuran',
            price: 18000,
            stock: 75,
            status: 'Tersedia',
            description: 'Buncis segar pilihan, renyah dan bergizi.'
        }, {
            id: 'PRD006',
            image: '../../../uas_workshopui/img/featured/mangga.jpg',
            name: 'Mangga Kuning Manis',
            category: 'Buahan',
            price: 18000,
            stock: 60,
            status: 'Tersedia',
            description: 'Mangga kuning manis, siap disantap.'
        }, {
            id: 'PRD007',
            image: '../../../uas_workshopui/img/featured/brokoli.png',
            name: 'Brokoli Hijau',
            category: 'Sayuran',
            price: 20000,
            stock: 90,
            status: 'Tersedia',
            description: 'Brokoli hijau segar, sumber vitamin dan serat.'
        }, {
            id: 'PRD008',
            image: '../../../uas_workshopui/img/featured/anggur.png',
            name: 'Anggur Ungu',
            category: 'Buahan',
            price: 38000,
            stock: 5,
            status: 'Stok Menipis',
            description: 'Anggur ungu pilihan, manis dan menyegarkan.'
        }, {
            id: 'PRD009',
            image: '../../../uas_workshopui/img/featured/semangka.png',
            name: 'Semangka Merah',
            category: 'Buahan',
            price: 20000,
            stock: 0,
            status: 'Habis',
            description: 'Semangka merah, cocok untuk cuaca panas.'
        }, {
            id: 'PRD010',
            image: '../../../uas_workshopui/img/featured/terong.png',
            name: 'Terong Ungu',
            category: 'Sayuran',
            price: 15000,
            stock: 200,
            status: 'Tersedia',
            description: 'Terong ungu segar, baik untuk kesehatan.'
        }, ];

        let currentEditProductId = null; // To store the ID of the product being edited

        const productTableBody = document.getElementById('productTableBody');
        const productForm = document.getElementById('productForm');
        const saveProductBtn = document.getElementById('saveProductBtn');
        const productModalLabel = document.getElementById('productModalLabel');
        const addProductBtn = document.getElementById('add-product-btn');

        const productIdInput = document.getElementById('productId');
        const productNameInput = document.getElementById('productName');
        const productCategorySelect = document.getElementById('productCategory');
        const productPriceInput = document.getElementById('productPrice');
        const productStockInput = document.getElementById('productStock');
        const productStatusSelect = document.getElementById('productStatus');
        const productDescriptionTextarea = document.getElementById('productDescription');
        const productImageInput = document.getElementById('productImage');
        const productImagePreview = document.getElementById('productImagePreview');

        const searchProductInput = document.getElementById('searchProduct');
        const searchButton = document.getElementById('searchButton');
        const filterCategorySelect = document.getElementById('filterCategory');
        const sortProductsSelect = document.getElementById('sortProducts');

        let currentPage = 1;
        const rowsPerPage = 10;

        // Function to render products in the table
        function renderProducts(dataToRender = products) {
            productTableBody.innerHTML = ''; // Clear existing rows
            const startIndex = (currentPage - 1) * rowsPerPage;
            const endIndex = startIndex + rowsPerPage;
            const paginatedProducts = dataToRender.slice(startIndex, endIndex);

            if (paginatedProducts.length === 0 && dataToRender.length > 0) {
                // If no products on current page but there are products overall, go to previous page
                currentPage = Math.max(1, currentPage - 1);
                renderProducts(dataToRender);
                return;
            }

            paginatedProducts.forEach(product => {
                const row = productTableBody.insertRow();
                row.dataset.productId = product.id; // Store product ID on the row

                let statusBadgeClass = '';
                if (product.status === 'Tersedia') {
                    statusBadgeClass = 'bg-success';
                } else if (product.status === 'Stok Menipis') {
                    statusBadgeClass = 'bg-warning';
                } else if (product.status === 'Habis') {
                    statusBadgeClass = 'bg-danger';
                }

                row.innerHTML = `
                    <td>${product.id}</td>
                    <td><img src="${product.image}" alt="product" class="img-fluid" width="50"></td>
                    <td>${product.name}</td>
                    <td>${product.category}</td>
                    <td>Rp ${product.price.toLocaleString('id-ID')}</td>
                    <td>${product.stock}</td>
                    <td><span class="badge ${statusBadgeClass}">${product.status}</span></td>
                    <td>
                        <div class="btn-group">
                            <button type="button" class="btn btn-sm btn-outline-primary edit-btn" data-bs-toggle="modal" data-bs-target="#productModal">
                                <i class="ti ti-edit"></i>
                            </button>
                            <button type="button" class="btn btn-sm btn-outline-danger delete-btn">
                                <i class="ti ti-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
            });
            updatePaginationControls(dataToRender.length);
            updatePaginationInfo(dataToRender.length);
        }

        // Function to generate a unique product ID
        function generateProductId() {
            const prefix = 'PRD';
            const existingIds = products.map(p => parseInt(p.id.replace(prefix, '')));
            const maxIdNum = existingIds.length > 0 ? Math.max(...existingIds) : 0;
            const newIdNum = maxIdNum + 1;
            return prefix + String(newIdNum).padStart(3, '0');
        }

        // Function to handle form submission (Add/Edit product)
        productForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            const productName = productNameInput.value;
            const productCategory = productCategorySelect.value;
            const productPrice = parseFloat(productPriceInput.value);
            const productStock = parseInt(productStockInput.value);
            const productStatus = productStatusSelect.value;
            const productDescription = productDescriptionTextarea.value;
            let productImage = productImagePreview.src || ''; // Use current preview if no new image is selected

            // Handle image upload if a new file is selected
            const file = productImageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    productImage = e.target.result;
                    processProductSave(productName, productCategory, productPrice, productStock, productStatus, productDescription, productImage);
                };
                reader.readAsDataURL(file);
            } else {
                processProductSave(productName, productCategory, productPrice, productStock, productStatus, productDescription, productImage);
            }
        });

        function processProductSave(productName, productCategory, productPrice, productStock, productStatus, productDescription, productImage) {
            if (currentEditProductId) {
                // Editing an existing product
                const productIndex = products.findIndex(p => p.id === currentEditProductId);
                if (productIndex !== -1) {
                    products[productIndex] = {
                        ...products[productIndex], // Keep existing properties if not updated
                        name: productName,
                        category: productCategory,
                        price: productPrice,
                        stock: productStock,
                        status: productStatus,
                        description: productDescription,
                        image: productImage
                    };
                    alert('Produk berhasil diperbarui!');
                }
            } else {
                // Adding a new product
                const newProductId = generateProductId();
                const newProduct = {
                    id: newProductId,
                    image: productImage || '../assets/images/placeholder.png', // Default placeholder if no image
                    name: productName,
                    category: productCategory,
                    price: productPrice,
                    stock: productStock,
                    status: productStatus,
                    description: productDescription
                };
                products.push(newProduct);
                alert('Produk berhasil ditambahkan!');
            }

            $('#productModal').modal('hide'); // Close the modal
            resetProductForm(); // Reset form fields
            applyFiltersAndSorting(); // Re-render products after add/edit
        }


        // Function to handle image preview
        productImageInput.addEventListener('change', function() {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    productImagePreview.src = e.target.result;
                    productImagePreview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                productImagePreview.src = '';
                productImagePreview.style.display = 'none';
            }
        });

        // Function to reset the product form
        function resetProductForm() {
            productForm.reset();
            productIdInput.value = 'Otomatis';
            productModalLabel.textContent = 'Tambah Produk';
            saveProductBtn.textContent = 'Simpan';
            currentEditProductId = null;
            productImagePreview.src = '';
            productImagePreview.style.display = 'none';
        }

        // Event listener for "Tambah Produk" button
        addProductBtn.addEventListener('click', function() {
            resetProductForm();
        });

        // Event listener for "Edit" buttons (delegated to parent table)
        productTableBody.addEventListener('click', function(event) {
            const editBtn = event.target.closest('.edit-btn');
            const deleteBtn = event.target.closest('.delete-btn');

            if (editBtn) {
                const row = editBtn.closest('tr');
                const productId = row.dataset.productId;
                const product = products.find(p => p.id === productId);

                if (product) {
                    productModalLabel.textContent = 'Edit Produk';
                    saveProductBtn.textContent = 'Perbarui';
                    currentEditProductId = product.id;

                    productIdInput.value = product.id;
                    productNameInput.value = product.name;
                    productCategorySelect.value = product.category;
                    productPriceInput.value = product.price;
                    productStockInput.value = product.stock;
                    productStatusSelect.value = product.status;
                    productDescriptionTextarea.value = product.description || ''; // Handle undefined description
                    if (product.image) {
                        productImagePreview.src = product.image;
                        productImagePreview.style.display = 'block';
                    } else {
                        productImagePreview.src = '';
                        productImagePreview.style.display = 'none';
                    }
                }
            } else if (deleteBtn) {
                const row = deleteBtn.closest('tr');
                const productId = row.dataset.productId;
                if (confirm(`Apakah Anda yakin ingin menghapus produk dengan ID ${productId}?`)) {
                    products = products.filter(p => p.id !== productId);
                    alert('Produk berhasil dihapus!');
                    applyFiltersAndSorting(); // Re-render products after deletion
                }
            }
        });

        // Search, Filter, and Sort functionality
        function applyFiltersAndSorting() {
            let filteredProducts = [...products];

            // Search
            const searchTerm = searchProductInput.value.toLowerCase().trim();
            if (searchTerm) {
                filteredProducts = filteredProducts.filter(product =>
                    product.name.toLowerCase().includes(searchTerm) ||
                    product.id.toLowerCase().includes(searchTerm) ||
                    product.category.toLowerCase().includes(searchTerm)
                );
            }

            // Filter by Category
            const selectedCategory = filterCategorySelect.value;
            if (selectedCategory !== 'Semua Kategori') {
                filteredProducts = filteredProducts.filter(product =>
                    product.category === selectedCategory
                );
            }

            // Sort
            const sortOption = sortProductsSelect.value;
            filteredProducts.sort((a, b) => {
                switch (sortOption) {
                    case 'Nama (A-Z)':
                        return a.name.localeCompare(b.name);
                    case 'Nama (Z-A)':
                        return b.name.localeCompare(a.name);
                    case 'Harga (Rendah-Tinggi)':
                        return a.price - b.price;
                    case 'Harga (Tinggi-Rendah)':
                        return b.price - a.price;
                    case 'Stok (Rendah-Tinggi)':
                        return a.stock - b.stock;
                    case 'Stok (Tinggi-Rendah)':
                        return b.stock - a.stock;
                    default:
                        return 0; // No sorting
                }
            });
            renderProducts(filteredProducts);
        }

        searchButton.addEventListener('click', applyFiltersAndSorting);
        searchProductInput.addEventListener('keyup', applyFiltersAndSorting);
        filterCategorySelect.addEventListener('change', applyFiltersAndSorting);
        sortProductsSelect.addEventListener('change', applyFiltersAndSorting);


        // Pagination functionality
        function updatePaginationControls(totalItems) {
            const totalPages = Math.ceil(totalItems / rowsPerPage);
            const paginationControls = document.getElementById('paginationControls');
            paginationControls.innerHTML = '';

            const createPageItem = (pageNumber, text, isDisabled, isActive) => {
                const li = document.createElement('li');
                li.classList.add('page-item');
                if (isDisabled) li.classList.add('disabled');
                if (isActive) li.classList.add('active');

                const a = document.createElement('a');
                a.classList.add('page-link');
                a.href = '#';
                a.textContent = text;
                a.addEventListener('click', (e) => {
                    e.preventDefault();
                    if (!isDisabled && !isActive) {
                        currentPage = pageNumber;
                        applyFiltersAndSorting();
                    }
                });
                li.appendChild(a);
                return li;
            };

            // Previous button
            paginationControls.appendChild(createPageItem(currentPage - 1, 'Previous', currentPage === 1, false));

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                paginationControls.appendChild(createPageItem(i, i, false, i === currentPage));
            }

            // Next button
            paginationControls.appendChild(createPageItem(currentPage + 1, 'Next', currentPage === totalPages || totalPages === 0, false));
        }

        function updatePaginationInfo(totalItems) {
            const paginationInfo = document.getElementById('paginationInfo');
            const startIndex = (currentPage - 1) * rowsPerPage + 1;
            const endIndex = Math.min(startIndex + rowsPerPage - 1, totalItems);
            paginationInfo.textContent = `Menampilkan ${totalItems === 0 ? 0 : startIndex} sampai ${endIndex} dari ${totalItems} data`;
        }


        // Initial load of products
        document.addEventListener('DOMContentLoaded', () => {
            applyFiltersAndSorting();
            // User authentication (re-added from your commented out code)
            checkUserAuthentication();

            const logoutIcon = document.querySelector('#logout-icon');
            if (logoutIcon) {
                logoutIcon.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleLogout();
                });
            }

            const logoutOption = document.querySelector('#logout-option');
            if (logoutOption) {
                logoutOption.addEventListener('click', function(e) {
                    e.preventDefault();
                    handleLogout();
                });
            }
        });


        // Functions for logout and user authentication (from your original commented out code)
        function handleLogout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('minimarket_current_user');
                showLogoutMessage();
                setTimeout(() => {
                    window.location.href = '../pages/login.html';
                }, 1000);
            }
        }

        function showLogoutMessage() {
            let toast = document.getElementById('logoutToast');
            if (!toast) {
                toast = document.createElement('div');
                toast.id = 'logoutToast';
                toast.style.position = 'fixed';
                toast.style.top = '20px';
                toast.style.right = '20px';
                toast.style.backgroundColor = '#d1e7dd';
                toast.style.color = '#0f5132';
                toast.style.padding = '15px 25px';
                toast.style.borderRadius = '5px';
                toast.style.boxShadow = '0 4px 8px rgba(0, 0, 0, 0.1)';
                toast.style.zIndex = '9999';
                toast.style.opacity = '0';
                toast.style.transform = 'translateY(-20px)';
                toast.style.transition = 'opacity 0.3s, transform 0.3s';
                toast.textContent = 'Logging out...';
                document.body.appendChild(toast);
            }
            setTimeout(() => {
                toast.style.opacity = '1';
                toast.style.transform = 'translateY(0)';
            }, 100);
        }

        function checkUserAuthentication() {
            const currentUser = JSON.parse(localStorage.getItem('minimarket_current_user'));
            if (!currentUser) {
                window.location.href = '../pages/login.html';
            } else {
                updateUserInfo(currentUser);
            }
        }

        function updateUserInfo(user) {
            const userNameElements = document.querySelectorAll('.header-user-profile span');
            const userNameInDropdown = document.querySelector('.dropdown-user-profile h6');
            if (userNameElements.length > 0) {
                userNameElements.forEach(element => {
                    element.textContent = user.name || 'User';
                });
            }
            if (userNameInDropdown) {
                userNameInDropdown.textContent = user.name || 'User';
            }
            const userRoleElement = document.querySelector('.dropdown-user-profile span');
            if (userRoleElement) {
                userRoleElement.textContent = user.role || 'User';
            }
        }
    </script>
</body>
</html>