<!DOCTYPE html>
<html lang="en">
<head>
  <title>MiniMarket - Kelola Transaksi</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="MiniMarket Professional Transaction Management">
  <meta name="keywords" content="admin, dashboard, minimarket, transactions, sales">
  <meta name="author" content="MiniMarket">

  <!-- Favicon -->
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üè™</text></svg>" type="image/svg+xml">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    :root {
      --primary-color: #2563eb;
      --primary-light: #dbeafe;
      --secondary-color: #64748b;
      --success-color: #059669;
      --success-light: #d1fae5;
      --warning-color: #d97706;
      --warning-light: #fef3c7;
      --danger-color: #dc2626;
      --danger-light: #fee2e2;
      --info-color: #0891b2;
      --info-light: #cffafe;
      --dark-color: #1e293b;
      --light-color: #f8fafc;
      --border-color: #e2e8f0;
      --text-muted: #64748b;
      --sidebar-width: 280px;
      --header-height: 70px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--light-color);
      color: var(--dark-color);
      line-height: 1.6;
    }

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: var(--sidebar-width);
      height: 100vh;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      z-index: 1000;
      transition: all 0.3s ease;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    }

    .sidebar-header {
      padding: 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-brand {
      display: flex;
      align-items: center;
      text-decoration: none;
      color: white;
      font-size: 1.5rem;
      font-weight: 700;
    }

    .sidebar-brand i {
      margin-right: 0.75rem;
      font-size: 2rem;
    }

    .sidebar-nav {
      padding: 1rem 0;
    }

    .nav-section {
      margin-bottom: 2rem;
    }

    .nav-section-title {
      padding: 0 1.5rem 0.5rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: rgba(255, 255, 255, 0.7);
    }

    .nav-item {
      margin: 0.25rem 1rem;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 0.75rem 1rem;
      color: rgba(255, 255, 255, 0.8);
      text-decoration: none;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .nav-link:hover,
    .nav-link.active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      transform: translateX(4px);
    }

    .nav-link i {
      margin-right: 0.75rem;
      width: 20px;
      text-align: center;
    }

    /* Header Styles */
    .header {
      position: fixed;
      top: 0;
      left: var(--sidebar-width);
      right: 0;
      height: var(--header-height);
      background: white;
      border-bottom: 1px solid var(--border-color);
      z-index: 999;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 2rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .header-left {
      display: flex;
      align-items: center;
    }

    .header-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--dark-color);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.5rem 1rem;
      background: var(--light-color);
      border-radius: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .user-profile:hover {
      background: var(--primary-light);
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--primary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
    }

    /* Main Content */
    .main-content {
      margin-left: var(--sidebar-width);
      margin-top: var(--header-height);
      padding: 2rem;
      min-height: calc(100vh - var(--header-height));
    }

    /* Breadcrumb */
    .breadcrumb-container {
      margin-bottom: 2rem;
    }

    .breadcrumb {
      background: none;
      padding: 0;
      margin: 0;
    }

    .breadcrumb-item {
      color: var(--text-muted);
    }

    .breadcrumb-item.active {
      color: var(--dark-color);
      font-weight: 500;
    }

    .breadcrumb-item + .breadcrumb-item::before {
      content: ">";
      color: var(--text-muted);
    }

    /* Cards */
    .card {
      background: white;
      border-radius: 1rem;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid var(--border-color);
      overflow: hidden;
    }

    .card-header {
      padding: 1.5rem;
      border-bottom: 1px solid var(--border-color);
      background: var(--light-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: var(--dark-color);
      margin: 0;
    }

    .card-body {
      padding: 1.5rem;
    }

    /* Buttons */
    .btn {
      border-radius: 0.5rem;
      font-weight: 500;
      padding: 0.5rem 1rem;
      transition: all 0.3s ease;
      border: none;
    }

    .btn-primary {
      background: var(--primary-color);
      color: white;
    }

    .btn-primary:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    .btn-outline-primary {
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
      background: transparent;
    }

    .btn-outline-primary:hover {
      background: var(--primary-color);
      color: white;
    }

    .btn-outline-success {
      border: 1px solid var(--success-color);
      color: var(--success-color);
      background: transparent;
    }

    .btn-outline-success:hover {
      background: var(--success-color);
      color: white;
    }

    .btn-outline-danger {
      border: 1px solid var(--danger-color);
      color: var(--danger-color);
      background: transparent;
    }

    .btn-outline-danger:hover {
      background: var(--danger-color);
      color: white;
    }

    .btn-outline-secondary {
      border: 1px solid var(--border-color);
      color: var(--text-muted);
      background: transparent;
    }

    .btn-outline-secondary:hover {
      background: var(--secondary-color);
      color: white;
      border-color: var(--secondary-color);
    }

    /* Form Controls */
    .form-control,
    .form-select {
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      padding: 0.75rem;
      transition: all 0.3s ease;
    }

    .form-control:focus,
    .form-select:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 0.2rem rgba(37, 99, 235, 0.25);
    }

    .form-label {
      font-weight: 500;
      color: var(--dark-color);
      margin-bottom: 0.5rem;
    }

    /* Filter Controls */
    .filter-controls {
      background: white;
      padding: 1.5rem;
      border-radius: 1rem;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      border: 1px solid var(--border-color);
      margin-bottom: 1.5rem;
    }

    /* Table */
    .table-container {
      background: white;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid var(--border-color);
    }

    .table {
      margin: 0;
      border-collapse: collapse;
    }

    .table th {
      background: var(--light-color);
      padding: 1rem;
      text-align: left;
      font-weight: 600;
      color: var(--dark-color);
      border-bottom: 2px solid var(--border-color);
      font-size: 0.875rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .table td {
      padding: 1rem;
      border-bottom: 1px solid var(--border-color);
      color: var(--dark-color);
      vertical-align: middle;
    }

    .table tbody tr:hover {
      background: var(--light-color);
    }

    .table tbody tr:last-child td {
      border-bottom: none;
    }

    /* Status Badges */
    .status-badge {
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .status-menunggu {
      background: var(--info-light);
      color: var(--info-color);
    }

    .status-selesai {
      background: var(--success-light);
      color: var(--success-color);
    }

    .status-dibatalkan {
      background: var(--danger-light);
      color: var(--danger-color);
    }

    /* Modal */
    .modal-content {
      border-radius: 1rem;
      border: none;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    }

    .modal-header {
      border-bottom: 1px solid var(--border-color);
      padding: 1.5rem;
    }

    .modal-title {
      font-weight: 600;
      color: var(--dark-color);
    }

    .modal-body {
      padding: 1.5rem;
    }

    .modal-footer {
      border-top: 1px solid var(--border-color);
      padding: 1.5rem;
    }

    /* Transaction Summary */
    .transaction-summary {
      background: var(--light-color);
      border-radius: 0.5rem;
      padding: 1rem;
      margin-top: 1rem;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.5rem 0;
      border-bottom: 1px solid var(--border-color);
    }

    .summary-row:last-child {
      border-bottom: none;
      font-weight: 600;
      font-size: 1.1rem;
    }

    /* Pagination */
    .pagination {
      margin: 0;
    }

    .page-link {
      border: 1px solid var(--border-color);
      color: var(--dark-color);
      padding: 0.5rem 0.75rem;
      margin: 0 0.125rem;
      border-radius: 0.5rem;
      transition: all 0.3s ease;
    }

    .page-link:hover {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }

    .page-item.active .page-link {
      background: var(--primary-color);
      border-color: var(--primary-color);
      color: white;
    }

    .page-item.disabled .page-link {
      color: var(--text-muted);
      background: var(--light-color);
      border-color: var(--border-color);
    }

    /* Footer */
    .footer {
      margin-left: var(--sidebar-width);
      padding: 1.5rem 2rem;
      background: white;
      border-top: 1px solid var(--border-color);
      text-align: center;
      color: var(--text-muted);
      font-size: 0.875rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .header {
        left: 0;
      }

      .main-content {
        margin-left: 0;
      }

      .footer {
        margin-left: 0;
      }

      .filter-controls .row > div {
        margin-bottom: 1rem;
      }
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .card {
      animation: fadeInUp 0.6s ease forwards;
    }

    /* Action Buttons */
    .action-buttons {
      display: flex;
      gap: 0.25rem;
    }

    .action-buttons .btn {
      padding: 0.375rem 0.5rem;
      font-size: 0.875rem;
    }

    /* Transaction Link */
    .transaction-link {
      color: var(--primary-color);
      text-decoration: none;
      font-weight: 500;
    }

    .transaction-link:hover {
      color: #1d4ed8;
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <a href="../../../uas_workshopui/index.html" class="sidebar-brand">
        <i class="fas fa-store"></i>
        MiniMarket
      </a>
    </div>
    
    <nav class="sidebar-nav">
      <div class="nav-section">
        <div class="nav-section-title">Main Navigation</div>
        <div class="nav-item">
          <a href="dashboard.html" class="nav-link">
            <i class="fas fa-chart-line"></i>
            Dashboard
          </a>
        </div>
        <div class="nav-item">
          <a href="kelola-produk.html" class="nav-link">
            <i class="fas fa-box"></i>
            Kelola Produk
          </a>
        </div>
        <div class="nav-item">
          <a href="kelola-transaksi.html" class="nav-link active">
            <i class="fas fa-receipt"></i>
            Kelola Transaksi
          </a>
        </div>
        <div class="nav-item">
          <a href="history-transaksi.html" class="nav-link">
            <i class="fas fa-history"></i>
            History Transaksi
          </a>
        </div>
        <div class="nav-item">
          <a href="kelola-pengguna.html" class="nav-link">
            <i class="fas fa-users"></i>
            Kelola Pengguna
          </a>
        </div>
        <div class="nav-item">
          <a href="kelola-artikel.html" class="nav-link">
            <i class="fas fa-file-alt"></i>
            Kelola Artikel
          </a>
        </div>
      </div>
    </nav>
  </div>

  <!-- Header -->
  <header class="header">
    <div class="header-left">
      <h1 class="header-title">Kelola Transaksi</h1>
    </div>
    <div class="header-right">
      <div class="user-profile" onclick="handleLogout()">
        <div class="user-avatar">A</div>
        <div>
          <div style="font-weight: 600; font-size: 0.875rem;">Admin</div>
          <div style="font-size: 0.75rem; color: var(--text-muted);">Administrator</div>
        </div>
        <i class="fas fa-chevron-down" style="font-size: 0.75rem; color: var(--text-muted);"></i>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Breadcrumb -->
    <div class="breadcrumb-container">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="dashboard.html">Home</a></li>
          <li class="breadcrumb-item active" aria-current="page">Kelola Transaksi</li>
        </ol>
      </nav>
    </div>

    <!-- Filter Controls -->
    <div class="filter-controls">
      <div class="row g-3">
        <div class="col-md-4">
          <div class="input-group">
            <input type="text" class="form-control" placeholder="Cari transaksi..." id="transactionSearch">
            <button class="btn btn-outline-secondary" type="button" id="searchButton">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
        <div class="col-md-3">
          <select class="form-select" id="statusFilter">
            <option value="">Semua Status</option>
            <option value="Menunggu Pembayaran">Menunggu Pembayaran</option>
            <option value="Selesai">Selesai</option>
            <option value="Dibatalkan">Dibatalkan</option>
          </select>
        </div>
        <div class="col-md-3">
          <input type="date" class="form-control" id="dateFilter">
        </div>
      </div>
    </div>

    <!-- Transactions Table -->
    <div class="table-container">
      <table class="table">
        <thead>
          <tr>
            <th>ID Transaksi</th>
            <th>Pelanggan</th>
            <th>Tanggal</th>
            <th>Total</th>
            <th>Status</th>
            <th>Metode Pembayaran</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="transactionTableBody">
          <!-- Transactions will be rendered here -->
        </tbody>
      </table>
      
      <!-- Pagination -->
      <div class="d-flex justify-content-between align-items-center p-3">
        <div>
          <span id="transactionInfo" class="text-muted">Menampilkan 0 sampai 0 dari 0 data</span>
        </div>
        <nav aria-label="Transaction pagination">
          <ul class="pagination" id="pagination">
            <!-- Pagination controls will be rendered here -->
          </ul>
        </nav>
      </div>
    </div>
  </main>

  <!-- New Transaction Modal -->
  <div class="modal fade" id="transactionModal" tabindex="-1" aria-labelledby="transactionModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="transactionModalLabel">Transaksi Baru</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="transactionForm">
            <!-- Customer Information -->
            <h6 class="mb-3">Informasi Pelanggan</h6>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="customerName" class="form-label">Nama Pelanggan <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="customerName" required>
              </div>
              <div class="col-md-6">
                <label for="customerPhone" class="form-label">No. Telepon <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="customerPhone" required>
              </div>
              <div class="col-12">
                <label for="customerAddress" class="form-label">Alamat <span class="text-danger">*</span></label>
                <textarea class="form-control" id="customerAddress" rows="2" required></textarea>
              </div>
            </div>

            <!-- Payment & Shipping Information -->
            <h6 class="mb-3">Informasi Pembayaran & Pengiriman</h6>
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="paymentMethod" class="form-label">Metode Pembayaran <span class="text-danger">*</span></label>
                <select class="form-select" id="paymentMethod" required>
                  <option value="">Pilih Metode Pembayaran</option>
                  <option value="Transfer Bank">Transfer Bank</option>
                  <option value="Kartu Kredit">Kartu Kredit</option>
                  <option value="E-Wallet">E-Wallet</option>
                  <option value="Tunai">Tunai</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="shippingMethod" class="form-label">Metode Pengiriman <span class="text-danger">*</span></label>
                <select class="form-select" id="shippingMethod" required>
                  <option value="">Pilih Metode Pengiriman</option>
                  <option value="Kurir Regular">Kurir Regular</option>
                  <option value="Kurir Express">Kurir Express</option>
                  <option value="Ambil di Toko">Ambil di Toko</option>
                </select>
              </div>
            </div>

            <!-- Products Section -->
            <h6 class="mb-3">Daftar Produk</h6>
            <div class="table-responsive">
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Produk</th>
                    <th width="120">Jumlah</th>
                    <th width="150">Harga</th>
                    <th width="150">Subtotal</th>
                    <th width="60">Aksi</th>
                  </tr>
                </thead>
                <tbody id="productList">
                  <!-- Product rows will be added here -->
                </tbody>
              </table>
              <button type="button" class="btn btn-outline-primary btn-sm" id="addProductRow">
                <i class="fas fa-plus"></i> Tambah Produk
              </button>
            </div>

            <!-- Transaction Summary -->
            <div class="transaction-summary">
              <div class="summary-row">
                <span>Subtotal:</span>
                <span id="modalSubtotal">Rp 0</span>
              </div>
              <div class="summary-row">
                <span>Biaya Pengiriman:</span>
                <span id="modalShippingCost">Rp 15,000</span>
              </div>
              <div class="summary-row">
                <span>Total:</span>
                <span id="modalTotal">Rp 15,000</span>
              </div>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Batal</button>
          <button type="button" class="btn btn-primary" id="saveTransaction">
            <i class="fas fa-save"></i> Simpan Transaksi
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Transaction Detail Modal -->
  <div class="modal fade" id="transactionDetailModal" tabindex="-1" aria-labelledby="transactionDetailModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="transactionDetailModalLabel">Detail Transaksi</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row mb-4">
            <div class="col-md-6">
              <h6 class="mb-3">Informasi Pelanggan</h6>
              <p class="mb-2"><strong>Nama:</strong> <span id="detailCustomerName"></span></p>
              <p class="mb-2"><strong>No. Telepon:</strong> <span id="detailCustomerPhone"></span></p>
              <p class="mb-2"><strong>Alamat:</strong> <span id="detailCustomerAddress"></span></p>
            </div>
            <div class="col-md-6">
              <h6 class="mb-3">Informasi Transaksi</h6>
              <p class="mb-2"><strong>Tanggal:</strong> <span id="detailTransactionDate"></span></p>
              <p class="mb-2"><strong>Status:</strong> <span id="detailTransactionStatus"></span></p>
              <p class="mb-2"><strong>Metode Pembayaran:</strong> <span id="detailPaymentMethod"></span></p>
              <p class="mb-2"><strong>Metode Pengiriman:</strong> <span id="detailShippingMethod"></span></p>
            </div>
          </div>

          <h6 class="mb-3">Daftar Produk</h6>
          <div class="table-responsive">
            <table class="table table-bordered">
              <thead>
                <tr>
                  <th>Produk</th>
                  <th>Harga</th>
                  <th>Jumlah</th>
                  <th>Subtotal</th>
                </tr>
              </thead>
              <tbody id="detailProductList">
                <!-- Product details will be rendered here -->
              </tbody>
            </table>
          </div>

          <div class="transaction-summary">
            <div class="summary-row">
              <span>Subtotal:</span>
              <span id="detailSubtotal"></span>
            </div>
            <div class="summary-row">
              <span>Biaya Pengiriman:</span>
              <span id="detailShippingCost"></span>
            </div>
            <div class="summary-row">
              <span>Total:</span>
              <span id="detailTotal"></span>
            </div>
          </div>

          <h6 class="mt-4 mb-3">Riwayat Status</h6>
          <div class="list-group" id="statusHistoryList">
            <!-- Status history will be rendered here -->
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Tutup</button>
          <button type="button" class="btn btn-primary" id="printInvoice">
            <i class="fas fa-print"></i> Cetak Invoice
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <footer class="footer">
    <p>&copy; 2025 MiniMarket Professional Dashboard. All rights reserved.</p>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // Sample product data
    const products = [
      { id: 'PROD-001', name: 'Sayur Pakcoy Segar', price: 20000 },
      { id: 'PROD-002', name: 'Wortel Segar', price: 18000 },
      { id: 'PROD-003', name: 'Brokoli Segar', price: 20000 },
      { id: 'PROD-004', name: 'Pisang Kuning Premium', price: 20000 },
      { id: 'PROD-005', name: 'Buah Apel Merah', price: 18000 },
      { id: 'PROD-006', name: 'Semangka Manis', price: 15000 },
      { id: 'PROD-007', name: 'Buncis Segar', price: 15000 },
      { id: 'PROD-008', name: 'Mangga Kuning', price: 18000 },
      { id: 'PROD-009', name: 'Jeruk Manis', price: 15000 },
      { id: 'PROD-010', name: 'Kentang Organik', price: 12000 }
    ];

    const SHIPPING_COST = 15000;
    let currentPage = 1;
    const rowsPerPage = 5;

    // Utility Functions
    function formatRupiah(number) {
      return new Intl.NumberFormat('id-ID', {
        style: 'currency',
        currency: 'IDR',
        minimumFractionDigits: 0
      }).format(number);
    }

    function generateTransactionId() {
      const date = new Date();
      const year = date.getFullYear().toString().slice(2);
      const month = (date.getMonth() + 1).toString().padStart(2, '0');
      const day = date.getDate().toString().padStart(2, '0');
      const hours = date.getHours().toString().padStart(2, '0');
      const minutes = date.getMinutes().toString().padStart(2, '0');
      const seconds = date.getSeconds().toString().padStart(2, '0');
      const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
      return `TRX-${year}${month}${day}-${hours}${minutes}${seconds}-${random}`;
    }

    // Transaction Data Management
    function getTransactions() {
      const transactions = localStorage.getItem('minimarket_transactions');
      return transactions ? JSON.parse(transactions) : [];
    }

    function saveTransactions(transactions) {
      localStorage.setItem('minimarket_transactions', JSON.stringify(transactions));
    }

    // Render Transactions Table
    function renderTransactions(transactionsToDisplay) {
      const tableBody = document.getElementById('transactionTableBody');
      tableBody.innerHTML = '';

      const start = (currentPage - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      const paginatedTransactions = transactionsToDisplay.slice(start, end);

      if (paginatedTransactions.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="7" class="text-center py-4">Tidak ada transaksi yang ditemukan.</td></tr>';
        document.getElementById('transactionInfo').textContent = 'Menampilkan 0 sampai 0 dari 0 data';
        document.getElementById('pagination').innerHTML = '';
        return;
      }

      paginatedTransactions.forEach(transaction => {
        const row = tableBody.insertRow();
        row.innerHTML = `
          <td>
            <a href="#" class="transaction-link view-transaction" data-transaction-id="${transaction.id}">
              ${transaction.id}
            </a>
          </td>
          <td>${transaction.customerName}</td>
          <td>${transaction.date}</td>
          <td><strong>${formatRupiah(transaction.total)}</strong></td>
          <td>
            <span class="status-badge ${getStatusClass(transaction.status)}">
              ${transaction.status}
            </span>
          </td>
          <td>${transaction.paymentMethod}</td>
          <td>
            <div class="action-buttons">
              <button type="button" class="btn btn-outline-primary btn-sm view-transaction" data-transaction-id="${transaction.id}" title="Lihat Detail">
                <i class="fas fa-eye"></i>
              </button>
              <button type="button" class="btn btn-outline-success btn-sm complete-transaction" data-transaction-id="${transaction.id}" 
                ${transaction.status === 'Selesai' || transaction.status === 'Dibatalkan' ? 'disabled' : ''} title="Selesaikan">
                <i class="fas fa-check"></i>
              </button>
              <button type="button" class="btn btn-outline-danger btn-sm cancel-transaction" data-transaction-id="${transaction.id}" 
                ${transaction.status === 'Selesai' || transaction.status === 'Dibatalkan' ? 'disabled' : ''} title="Batalkan">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </td>
        `;
      });

      updatePagination(transactionsToDisplay.length);
      updateTransactionInfo(transactionsToDisplay.length);
      attachEventListeners();
    }

    function getStatusClass(status) {
      switch (status) {
        case 'Menunggu Pembayaran':
          return 'status-menunggu';
        case 'Selesai':
          return 'status-selesai';
        case 'Dibatalkan':
          return 'status-dibatalkan';
        default:
          return 'status-menunggu';
      }
    }

    function attachEventListeners() {
      document.querySelectorAll('.view-transaction').forEach(button => {
        button.addEventListener('click', function(e) {
          e.preventDefault();
          const transactionId = this.dataset.transactionId;
          showTransactionDetail(transactionId);
        });
      });

      document.querySelectorAll('.complete-transaction').forEach(button => {
        button.addEventListener('click', function() {
          const transactionId = this.dataset.transactionId;
          if (confirm('Apakah Anda yakin ingin menyelesaikan transaksi ini?')) {
            updateTransactionStatus(transactionId, 'Selesai');
          }
        });
      });

      document.querySelectorAll('.cancel-transaction').forEach(button => {
        button.addEventListener('click', function() {
          const transactionId = this.dataset.transactionId;
          if (confirm('Apakah Anda yakin ingin membatalkan transaksi ini?')) {
            updateTransactionStatus(transactionId, 'Dibatalkan');
          }
        });
      });
    }

    // Pagination
    function updatePagination(totalRows) {
      const totalPages = Math.ceil(totalRows / rowsPerPage);
      const paginationUl = document.getElementById('pagination');
      paginationUl.innerHTML = '';

      const createPageItem = (page, text, isActive, isDisabled) => {
        const li = document.createElement('li');
        li.classList.add('page-item');
        if (isActive) li.classList.add('active');
        if (isDisabled) li.classList.add('disabled');

        const a = document.createElement('a');
        a.classList.add('page-link');
        a.href = '#';
        a.textContent = text;
        a.addEventListener('click', (e) => {
          e.preventDefault();
          if (!isDisabled) {
            currentPage = page;
            applyFilters();
          }
        });

        li.appendChild(a);
        return li;
      };

      paginationUl.appendChild(createPageItem(currentPage - 1, 'Previous', false, currentPage === 1));

      for (let i = 1; i <= totalPages; i++) {
        paginationUl.appendChild(createPageItem(i, i, i === currentPage, false));
      }

      paginationUl.appendChild(createPageItem(currentPage + 1, 'Next', false, currentPage === totalPages || totalPages === 0));
    }

    function updateTransactionInfo(totalRows) {
      const start = (currentPage - 1) * rowsPerPage + 1;
      const end = Math.min(start + rowsPerPage - 1, totalRows);
      document.getElementById('transactionInfo').textContent = `Menampilkan ${totalRows === 0 ? 0 : start} sampai ${end} dari ${totalRows} data`;
    }

    // Filter and Search
    function applyFilters() {
      const searchTerm = document.getElementById('transactionSearch').value.toLowerCase();
      const statusFilter = document.getElementById('statusFilter').value;
      const dateFilter = document.getElementById('dateFilter').value;

      let filteredTransactions = getTransactions();

      if (searchTerm) {
        filteredTransactions = filteredTransactions.filter(transaction =>
          transaction.id.toLowerCase().includes(searchTerm) ||
          transaction.customerName.toLowerCase().includes(searchTerm) ||
          transaction.paymentMethod.toLowerCase().includes(searchTerm)
        );
      }

      if (statusFilter) {
        filteredTransactions = filteredTransactions.filter(transaction =>
          transaction.status === statusFilter
        );
      }

      if (dateFilter) {
        filteredTransactions = filteredTransactions.filter(transaction =>
          transaction.date === new Date(dateFilter).toLocaleDateString('id-ID', {
            day: '2-digit',
            month: 'long',
            year: 'numeric'
          })
        );
      }

      renderTransactions(filteredTransactions);
    }

    // Product Row Management
    function addProductRow() {
      const productList = document.getElementById('productList');
      const newRow = document.createElement('tr');
      newRow.innerHTML = `
        <td>
          <select class="form-select product-select">
            <option value="">Pilih Produk</option>
            ${products.map(p => `<option value="${p.id}" data-price="${p.price}">${p.name}</option>`).join('')}
          </select>
        </td>
        <td>
          <input type="number" class="form-control product-quantity" value="1" min="1">
        </td>
        <td>
          <input type="text" class="form-control product-price" value="Rp 0" readonly>
        </td>
        <td>
          <input type="text" class="form-control product-subtotal" value="Rp 0" readonly>
        </td>
        <td>
          <button type="button" class="btn btn-outline-danger btn-sm remove-product-row" title="Hapus">
            <i class="fas fa-trash"></i>
          </button>
        </td>
      `;
      productList.appendChild(newRow);
      attachProductRowListeners(newRow);
      calculateModalTotals();
    }

    function attachProductRowListeners(row) {
      const productSelect = row.querySelector('.product-select');
      const quantityInput = row.querySelector('.product-quantity');
      const priceInput = row.querySelector('.product-price');
      const subtotalInput = row.querySelector('.product-subtotal');
      const removeButton = row.querySelector('.remove-product-row');

      productSelect.addEventListener('change', () => {
        const selectedProduct = products.find(p => p.id === productSelect.value);
        if (selectedProduct) {
          priceInput.value = formatRupiah(selectedProduct.price);
          subtotalInput.value = formatRupiah(selectedProduct.price * parseInt(quantityInput.value));
        } else {
          priceInput.value = 'Rp 0';
          subtotalInput.value = 'Rp 0';
        }
        calculateModalTotals();
      });

      quantityInput.addEventListener('input', () => {
        const selectedProduct = products.find(p => p.id === productSelect.value);
        const quantity = parseInt(quantityInput.value);
        if (selectedProduct && quantity > 0) {
          subtotalInput.value = formatRupiah(selectedProduct.price * quantity);
        } else {
          subtotalInput.value = 'Rp 0';
        }
        calculateModalTotals();
      });

      removeButton.addEventListener('click', () => {
        row.remove();
        calculateModalTotals();
      });
    }

    function calculateModalTotals() {
      let subtotal = 0;
      document.querySelectorAll('#productList tr').forEach(row => {
        const productSelect = row.querySelector('.product-select');
        const quantityInput = row.querySelector('.product-quantity');

        const selectedProduct = products.find(p => p.id === productSelect.value);
        const quantity = parseInt(quantityInput.value) || 0;

        if (selectedProduct && quantity > 0) {
          subtotal += selectedProduct.price * quantity;
        }
      });

      document.getElementById('modalSubtotal').textContent = formatRupiah(subtotal);
      document.getElementById('modalShippingCost').textContent = formatRupiah(SHIPPING_COST);
      document.getElementById('modalTotal').textContent = formatRupiah(subtotal + SHIPPING_COST);
    }

    // Save Transaction
    function saveNewTransaction() {
      const customerName = document.getElementById('customerName').value;
      const customerPhone = document.getElementById('customerPhone').value;
      const customerAddress = document.getElementById('customerAddress').value;
      const paymentMethod = document.getElementById('paymentMethod').value;
      const shippingMethod = document.getElementById('shippingMethod').value;

      if (!customerName || !customerPhone || !customerAddress || !paymentMethod || !shippingMethod) {
        showToast('Harap lengkapi semua informasi pelanggan dan pengiriman.', 'error');
        return;
      }

      const transactionProducts = [];
      let subtotal = 0;

      document.querySelectorAll('#productList tr').forEach(row => {
        const productSelect = row.querySelector('.product-select');
        const quantityInput = row.querySelector('.product-quantity');

        const selectedProduct = products.find(p => p.id === productSelect.value);
        const quantity = parseInt(quantityInput.value) || 0;

        if (selectedProduct && quantity > 0) {
          const productSubtotal = selectedProduct.price * quantity;
          transactionProducts.push({
            id: selectedProduct.id,
            name: selectedProduct.name,
            price: selectedProduct.price,
            quantity: quantity,
            subtotal: productSubtotal
          });
          subtotal += productSubtotal;
        }
      });

      if (transactionProducts.length === 0) {
        showToast('Harap tambahkan setidaknya satu produk ke transaksi.', 'error');
        return;
      }

      const total = subtotal + SHIPPING_COST;

      const newTransaction = {
        id: generateTransactionId(),
        customerName: customerName,
        customerPhone: customerPhone,
        customerAddress: customerAddress,
        date: new Date().toLocaleDateString('id-ID', {
          day: '2-digit',
          month: 'long',
          year: 'numeric'
        }),
        total: total,
        status: 'Menunggu Pembayaran',
        paymentMethod: paymentMethod,
        shippingMethod: shippingMethod,
        products: transactionProducts,
        statusHistory: [{
          status: 'Menunggu Pembayaran',
          timestamp: new Date().toLocaleString('id-ID')
        }]
      };

      const transactions = getTransactions();
      transactions.unshift(newTransaction);
      saveTransactions(transactions);
      
      showToast('Transaksi berhasil dibuat!', 'success');
      bootstrap.Modal.getInstance(document.getElementById('transactionModal')).hide();
      resetTransactionForm();
      applyFilters();
    }

    // Reset Transaction Form
    function resetTransactionForm() {
      document.getElementById('transactionForm').reset();
      document.getElementById('productList').innerHTML = '';
      addProductRow();
      calculateModalTotals();
    }

    // Show Transaction Detail
    function showTransactionDetail(transactionId) {
      const transactions = getTransactions();
      const transaction = transactions.find(t => t.id === transactionId);

      if (!transaction) {
        showToast('Transaksi tidak ditemukan.', 'error');
        return;
      }

      document.getElementById('transactionDetailModalLabel').textContent = `Detail Transaksi #${transaction.id}`;
      document.getElementById('detailCustomerName').textContent = transaction.customerName;
      document.getElementById('detailCustomerPhone').textContent = transaction.customerPhone;
      document.getElementById('detailCustomerAddress').textContent = transaction.customerAddress;
      document.getElementById('detailTransactionDate').textContent = transaction.date;
      document.getElementById('detailTransactionStatus').innerHTML = `<span class="status-badge ${getStatusClass(transaction.status)}">${transaction.status}</span>`;
      document.getElementById('detailPaymentMethod').textContent = transaction.paymentMethod;
      document.getElementById('detailShippingMethod').textContent = transaction.shippingMethod;

      const detailProductList = document.getElementById('detailProductList');
      detailProductList.innerHTML = '';
      transaction.products.forEach(product => {
        const row = detailProductList.insertRow();
        row.innerHTML = `
          <td>${product.name}</td>
          <td>${formatRupiah(product.price)}</td>
          <td>${product.quantity}</td>
          <td><strong>${formatRupiah(product.subtotal)}</strong></td>
        `;
      });

      document.getElementById('detailSubtotal').textContent = formatRupiah(transaction.products.reduce((sum, p) => sum + p.subtotal, 0));
      document.getElementById('detailShippingCost').textContent = formatRupiah(SHIPPING_COST);
      document.getElementById('detailTotal').textContent = formatRupiah(transaction.total);

      const statusHistoryList = document.getElementById('statusHistoryList');
      statusHistoryList.innerHTML = '';
      transaction.statusHistory.forEach(history => {
        const div = document.createElement('div');
        div.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'align-items-center');
        div.innerHTML = `
          <div>
            <span class="status-badge ${getStatusClass(history.status)}">${history.status}</span>
            <span class="ms-2">${getStatusDescription(history.status)}</span>
          </div>
          <small class="text-muted">${history.timestamp}</small>
        `;
        statusHistoryList.appendChild(div);
      });

      new bootstrap.Modal(document.getElementById('transactionDetailModal')).show();
    }

    function getStatusDescription(status) {
      switch (status) {
        case 'Menunggu Pembayaran':
          return 'Transaksi dibuat, menunggu pembayaran';
        case 'Selesai':
          return 'Transaksi selesai';
        case 'Dibatalkan':
          return 'Transaksi dibatalkan';
        default:
          return '';
      }
    }

    // Update Transaction Status
    function updateTransactionStatus(transactionId, newStatus) {
      let transactions = getTransactions();
      const transactionIndex = transactions.findIndex(t => t.id === transactionId);

      if (transactionIndex > -1) {
        transactions[transactionIndex].status = newStatus;
        transactions[transactionIndex].statusHistory.push({
          status: newStatus,
          timestamp: new Date().toLocaleString('id-ID')
        });
        saveTransactions(transactions);
        applyFilters();
        showToast(`Status transaksi ${transactionId} berhasil diperbarui menjadi ${newStatus}.`, 'success');
      } else {
        showToast('Transaksi tidak ditemukan.', 'error');
      }
    }

    // Toast Notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.style.position = 'fixed';
      toast.style.top = '20px';
      toast.style.right = '20px';
      toast.style.padding = '15px 25px';
      toast.style.borderRadius = '0.5rem';
      toast.style.color = 'white';
      toast.style.fontWeight = '500';
      toast.style.zIndex = '9999';
      toast.style.opacity = '0';
      toast.style.transform = 'translateY(-20px)';
      toast.style.transition = 'all 0.3s ease';
      
      if (type === 'success') {
        toast.style.background = 'var(--success-color)';
      } else if (type === 'error') {
        toast.style.background = 'var(--danger-color)';
      }
      
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.opacity = '1';
        toast.style.transform = 'translateY(0)';
      }, 100);

      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateY(-20px)';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 3000);
    }

    // Logout functionality
    function handleLogout() {
      if (confirm('Apakah Anda yakin ingin logout?')) {
        showToast('Logout berhasil!', 'success');
        setTimeout(() => {
          alert('Redirect to login page');
        }, 1000);
      }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize transaction table
      applyFilters();

      // Event listeners
      document.getElementById('addProductRow').addEventListener('click', addProductRow);
      document.getElementById('saveTransaction').addEventListener('click', saveNewTransaction);
      document.getElementById('searchButton').addEventListener('click', applyFilters);
      document.getElementById('statusFilter').addEventListener('change', () => {
        currentPage = 1;
        applyFilters();
      });
      document.getElementById('dateFilter').addEventListener('change', () => {
        currentPage = 1;
        applyFilters();
      });
      document.getElementById('transactionSearch').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          e.preventDefault();
          currentPage = 1;
          applyFilters();
        }
      });

      // Reset form when modal is hidden
      document.getElementById('transactionModal').addEventListener('hidden.bs.modal', resetTransactionForm);

      // Print invoice
      document.getElementById('printInvoice').addEventListener('click', function() {
        window.print();
      });

      // Initial product row
      addProductRow();
    });
  </script>
</body>
</html>